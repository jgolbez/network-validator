tests:
  # ============================================================================
  # STEP 1: Extract Desktop IPs from DHCP Binding
  # ============================================================================

  - name: "Extract Desktop-0 IP from DHCP"
    description: "Find desktop-0's DHCP-assigned IP by matching its MAC address"
    command: "show ip dhcp binding"
    match_type: "contains"
    expected: "0152.5400.0ee7.0e"
    extract_var: "desktop_0_ip"
    extract_pattern: '(\d+\.\d+\.\d+\.\d+)\s+0152\.5400\.0ee7\.0e'
    devices: ["CORE-SW1"]

  - name: "Extract Desktop-0 Subnet Mask from DHCP Pool Config"
    description: "Extract subnet mask from running config DHCP pool network statement"
    command: "show run | section ip dhcp pool DESKTOP"
    match_type: "contains"
    expected: "network 10.10.10.0"
    extract_var: "desktop_0_subnet_mask"
    extract_pattern: 'network\s+\d+\.\d+\.\d+\.\d+\s+(\d+\.\d+\.\d+\.\d+)'
    devices: ["CORE-SW1"]

  - name: "Extract Desktop-1 IP from DHCP"
    description: "Find desktop-1's DHCP-assigned IP by matching its MAC address (from CORE-SW2)"
    command: "show ip dhcp binding"
    match_type: "contains"
    expected: "0152.5400.c168.c3"
    extract_var: "desktop_1_ip"
    extract_pattern: '(\d+\.\d+\.\d+\.\d+)\s+0152\.5400\.c168\.c3'
    devices: ["CORE-SW2"]

  # ============================================================================
  # STEP 2: Verify DHCP is Working (Not Static IPs)
  # ============================================================================

  - name: "Desktop-0 uses DHCP"
    description: "Verify desktop-0 IP is from active DHCP lease, not static"
    command: "show ip dhcp binding"
    match_type: "regex"
    expected: '0152\.5400\.0ee7\.0e.*Automatic.*Active'
    devices: ["CORE-SW1"]

  - name: "Desktop-1 uses DHCP"
    description: "Verify desktop-1 IP is from active DHCP lease, not static (on CORE-SW2)"
    command: "show ip dhcp binding"
    match_type: "regex"
    expected: '0152\.5400\.c168\.c3.*Automatic.*Active'
    devices: ["CORE-SW2"]

  # ============================================================================
  # STEP 3: Verify No Access-Lists Block Desktop-0
  # ============================================================================

  - name: "No ACL denies Desktop-0 Host or Subnet"
    description: "Check that no access-list denies desktop-0 by host IP or subnet (standard or extended ACL)"
    command: "show access-lists"
    match_type: "not_regex"
    expected: 'deny\s+(?:ip\s+)?(?:host\s+)?{desktop_0_ip}(?:\s|$)|deny\s+(?:ip\s+)?{desktop_0_network}\s+{desktop_0_wildcard}|deny\s+{desktop_0_network}\s+{desktop_0_subnet_mask}'
    devices: ["CORE-SW1", "CORE-SW2"]

  # ============================================================================
  # STEP 4: Connectivity Tests (Task Outcome Validation)
  # Note: This test will PASS before task completion (ping succeeds)
  # After task completion, it should FAIL (ping blocked by attendee's solution)
  # ============================================================================

  - name: "Desktop-1 can ping Desktop-0 (before task)"
    description: "Desktop-1 should be able to reach Desktop-0 before task completion (at least 1 successful ping response)"
    command: "ssh -l cisco {desktop_1_ip} \"ping -c 3 {desktop_0_ip}\""
    match_type: "contains"
    expected: "bytes from"
    devices: ["CORE-SW1"]
    ssh_password: "cisco"
