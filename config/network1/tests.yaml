tests:
  # ============================================================================
  # STEP 1: Extract Desktop IPs from DHCP Binding
  # ============================================================================

  - name: "Extract Desktop-0 IP from DHCP"
    description: "Find desktop-0's DHCP-assigned IP by matching its MAC address"
    command: "show ip dhcp binding"
    match_type: "contains"
    expected: "0152.5400.0ee7.0e"
    extract_var: "desktop_0_ip"
    extract_pattern: '0152\.5400\.0ee7\.0e\s+.*?(\d+\.\d+\.\d+\.\d+)'

  - name: "Extract Desktop-1 IP from DHCP"
    description: "Find desktop-1's DHCP-assigned IP by matching its MAC address"
    command: "show ip dhcp binding"
    match_type: "contains"
    expected: "0152.5400.c168.c3"
    extract_var: "desktop_1_ip"
    extract_pattern: '0152\.5400\.c168\.c3\s+.*?(\d+\.\d+\.\d+\.\d+)'

  # ============================================================================
  # STEP 2: Verify DHCP is Working (Not Static IPs)
  # ============================================================================

  - name: "Desktop-0 uses DHCP"
    description: "Verify desktop-0 IP is from active DHCP lease, not static"
    command: "show ip dhcp binding"
    match_type: "regex"
    expected: '0152\.5400\.0ee7\.0e.*Automatic.*Active'

  - name: "Desktop-1 uses DHCP"
    description: "Verify desktop-1 IP is from active DHCP lease, not static"
    command: "show ip dhcp binding"
    match_type: "regex"
    expected: '0152\.5400\.c168\.c3.*Automatic.*Active'

  # ============================================================================
  # STEP 3: Verify No Access-Lists Block Desktop IPs
  # ============================================================================

  - name: "No ACL denies Desktop-0 IP"
    description: "Check that no access-list contains a deny for desktop-0"
    command: "show access-lists"
    match_type: "not_contains"
    expected: "deny.*{desktop_0_ip}"

  - name: "No ACL denies Desktop-1 IP"
    description: "Check that no access-list contains a deny for desktop-1"
    command: "show access-lists"
    match_type: "not_contains"
    expected: "deny.*{desktop_1_ip}"

  - name: "No Standard ACL denies Desktop-0"
    description: "Standard ACLs may just show 'deny 10.10.10.x' format"
    command: "show access-lists"
    match_type: "not_contains"
    expected: "deny   {desktop_0_ip}"

  - name: "No Standard ACL denies Desktop-1"
    description: "Standard ACLs may just show 'deny 10.10.10.x' format"
    command: "show access-lists"
    match_type: "not_contains"
    expected: "deny   {desktop_1_ip}"

  # ============================================================================
  # STEP 4: Connectivity Tests (Task Outcome Validation)
  # Note: These will fail if the task hasn't been completed yet, which is OK
  # They demonstrate what the validator will check once attendees modify network
  # ============================================================================

  - name: "Ping Desktop-1 from CORE-SW1 should fail (task complete)"
    description: "After task, CORE-SW1 should NOT be able to ping desktop-1"
    command: "ping {desktop_1_ip} source 10.10.10.2"
    match_type: "contains"
    expected: "Destination unreachable"

  - name: "Ping Desktop-1 from CORE-SW2 should fail (task complete)"
    description: "After task, CORE-SW2 should NOT be able to ping desktop-1"
    command: "ping {desktop_1_ip} source 10.10.10.3"
    match_type: "contains"
    expected: "Destination unreachable"

  - name: "Ping Desktop-0 should still work"
    description: "Desktop-0 should remain reachable from CORE switches"
    command: "ping {desktop_0_ip} source 10.10.10.2"
    match_type: "contains"
    expected: "!!!"
